<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>6e – Les nombres décimaux (14 exercices)</title>
  <style>
    :root {
      --bg: #0e1630;
      --panel: #111a3b;
      --ink: #e6ecff;
      --muted: #a9b6df;
      --accent: #5dd6ff;
      --accent-2: #9bffb0;
      --warn: #ffd166;
      --bad: #ff7b7b;
      --good: #8be98b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink);
      background: radial-gradient(1200px 700px at 10% -10%, #1d2a56 0%, transparent 70%),
                  radial-gradient(1000px 600px at 110% 0%, #23336a 0%, transparent 70%),
                  linear-gradient(180deg, #0a1030, #0e1630 40%, #0b122a);
      overflow-x: hidden;
    }
    header {
      position: sticky; 
      top: 0; 
      z-index: 20;
      background: rgba(17, 26, 59, 0.95); 
      backdrop-filter: blur(8px);
      box-shadow: var(--shadow); 
      padding: 6px 16px;      /* Hauteur réduite du volet */
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 8px 16px 60px; }
    h1 { margin: 0; font-size: clamp(1.1rem, 2.3vw, 1.6rem); letter-spacing: .5px; }
    .subtitle { margin-top: 2px; color: var(--muted); font-size: .78rem; line-height: 1.3; }
    .header-info { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 6px; margin-top: 3px; font-size: .85rem; }
    #global-score { color: var(--accent-2); }
    #timer { color: var(--warn); font-weight: 600; }
    #badges { color: var(--accent); }
    .mode-toggle { display: flex; gap: 12px; font-size: .78rem; margin-top: 4px; flex-wrap: wrap; }
    .mode-toggle label { display: flex; align-items: center; gap: 4px; cursor: pointer; }
    .idcard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; background: var(--panel); border: 1px solid #1c2656; border-radius: 12px; padding: 10px; margin: 10px 0 16px; box-shadow: var(--shadow); animation: pop .5s ease-out; }
    label { font-size: .82rem; color: var(--muted); display: block; margin-bottom: 4px; }
    input[type="text"], .short, select { width: 100%; background: #0b1432; border: 1px solid #20306a; border-radius: 8px; color: var(--ink); padding: 7px 9px; outline: none; transition: border .2s ease, box-shadow .2s ease; font-size: .9rem; }
    input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(93, 214, 255, .2); }
    .exo { background: var(--panel); border: 1px solid #1b2450; border-radius: 14px; padding: 12px; margin: 10px 0; box-shadow: var(--shadow); overflow: hidden; transition: transform 0.2s ease; }
    .exo:hover { transform: scale(1.01); }
    .exo h2 { margin: 0 0 4px; font-size: clamp(.95rem, 2vw, 1.05rem); }
    .consigne { margin: 0 0 8px; color: var(--muted); line-height: 1.45; animation: glow 3s ease-in-out infinite; font-size: .88rem; }
    .row { display: flex; flex-wrap: wrap; gap: 6px; align-items: center; }
    .btn { background: linear-gradient(180deg, var(--accent), #34b6ff); color: #051024; border: none; padding: 6px 11px; border-radius: 8px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 12px rgba(52, 182, 255, .35); transition: all .08s ease; font-size: .85rem; }
    .btn:hover { filter: brightness(1.06); }
    .btn:active { transform: translateY(1px); }
    .btn.alt { background: linear-gradient(180deg, #ffd166, #ffb347); color: #532c00; box-shadow: 0 4px 12px rgba(255, 179, 71, .35); }
    .btn.ghost { background: transparent; color: var(--accent); border: 1px dashed var(--accent); box-shadow: none; }
    .help { display: none; margin-top: 7px; background: #0c1740; border: 1px dashed #3150a8; border-radius: 8px; padding: 8px 10px; color: #d3ddff; line-height: 1.55; font-size: .85rem; }
    .feedback { margin-top: 5px; font-weight: 600; white-space: pre-wrap; font-size: .82rem; }
    .ok { color: var(--good); }
    .no { color: var(--bad); }
    .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
    .badge { display: inline-block; padding: 2px 6px; border-radius: 999px; background: #1a2b63; color: var(--accent); font-size: .7rem; margin-left: 4px; }
    .badge-earned { background: #9bffb0; color: #051024; font-weight: 600; animation: pop .4s ease-out; }
    .rank-label { font-weight: 600; color: var(--accent-2); }
    .step { margin: 6px 0; padding: 6px; background: #0d1a40; border-radius: 6px; border-left: 3px solid var(--accent); font-size: .82rem; }
    .step-title { font-weight: 600; color: var(--accent); margin-bottom: 3px; }
    #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000; }
    @keyframes glow { 0% { text-shadow: 0 0 0 rgba(93, 214, 255, 0); } 50% { text-shadow: 0 0 8px rgba(93, 214, 255, .2); } 100% { text-shadow: 0 0 0 rgba(93, 214, 255, 0); } }
    @keyframes pop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
  </style>
</head>
<body>
  <canvas id="confetti-canvas"></canvas>
  <audio id="sound-success" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" preload="auto"></audio>
  <audio id="sound-error" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-383.mp3" preload="auto"></audio>

  <header class="wrap">
    <h1>6e – Les nombres décimaux <span class="badge">14 exercices</span></h1>
    <div class="subtitle">Complète les réponses puis clique sur <strong>Correction</strong> pour vérifier. Tu peux aussi cliquer sur <strong>Aide</strong> pour un indice adapté aux 6e. N'hésite pas à recommencer pour t'améliorer !</div>
    
    <div class="header-info">
      <div>
        <div id="global-score">Score total : 0 / 100</div>
        <div id="timer">Temps : 00:00</div>
        <div id="badges">Badges : aucun pour l'instant</div>
      </div>
      <div class="mode-toggle">
        <label><input type="checkbox" id="easy-mode"> Mode facile</label>
        <label><input type="checkbox" id="timer-mode" checked> Chronométré</label>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="idcard">
      <div><label for="nom">Nom</label><input id="nom" type="text" placeholder="Ex. : Martin" /></div>
      <div><label for="prenom">Prénom</label><input id="prenom" type="text" placeholder="Ex. : Léa" /></div>
      <div><label for="classe">Classe</label><input id="classe" type="text" placeholder="Ex. : 6e B" /></div>
    </section>

    <div class="row" style="justify-content: flex-end; margin-bottom:8px;">
      <button class="btn ghost" onclick="corrigerTout()">Corriger tout et voir ton score !</button>
    </div>

    <!-- EXERCICE 1 -->
    <section id="exo1" class="exo">
      <h2>Exercice 1 — Partie entière et partie décimale</h2>
      <p class="consigne">Pour chaque nombre, indique <strong>la partie entière</strong> et <strong>la partie décimale  </strong>. (Astuce : la virgule sépare les deux parties.) Prends ton temps, tu vas y arriver !</p>
      <div class="grid-2">
        <div><label for="input-e1a-ent">4,53 → partie entière</label><input id="input-e1a-ent" data-key="e1a-ent" placeholder="4,53 → partie entière" /></div>
        <div><label for="input-e1a-dec">4,53 → partie décimale</label><input id="input-e1a-dec" data-key="e1a-dec" placeholder="4,53 → partie décimale" /></div>
        <div><label for="input-e1b-ent">529,5 → partie entière</label><input id="input-e1b-ent" data-key="e1b-ent" placeholder="529,5 → partie entière" /></div>
        <div><label for="input-e1b-dec">529,5 → partie décimale</label><input id="input-e1b-dec" data-key="e1b-dec" placeholder="529,5 → partie décimale" /></div>
        <div><label for="input-e1c-ent">0,83 → partie entière</label><input id="input-e1c-ent" data-key="e1c-ent" placeholder="0,83 → partie entière" /></div>
        <div><label for="input-e1c-dec">0,83 → partie décimale</label><input id="input-e1c-dec" data-key="e1c-dec" placeholder="0,83 → partie décimale" /></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn alt" onclick="toggleHelp('h1')">Aide détaillée</button>
        <button class="btn" onclick="corriger1()">Correction</button>
        <button class="btn ghost" onclick="resetExo(1)">Recommencer</button>
        <span id="f1" class="feedback"></span>
      </div>
      <div id="h1" class="help">
        <p>Bonjour ! On va y aller étape par étape.</p>
        <p>1. La <strong>partie entière</strong> est à gauche de la virgule.</p>
        <p>Exemple : Dans 4,53 → <strong>4</strong>.</p>
        <p>2. La <strong>partie décimale</strong> est à droite de la virgule.</p>
        <p>Exemple : Dans 4,53 → <strong>53</strong> (ou 0,53, ou 53/100).</p>
        <p>Si le nombre commence par 0, comme 0,83 → entière = 0, décimale = 83.</p>
        <p>Essaie de relire le nombre lentement et de repérer la virgule. Tu es capable !</p>
      </div>
    </section>

    <!-- EXERCICE 2 — NOMBRES GÉNÉRÉS ET AFFICHÉS -->
    <section id="exo2" class="exo">
      <h2>Exercice 2 — Chiffre des différents rangs</h2>
      <p class="consigne">Pour chaque nombre généré, indique le <strong>chiffre du rang demandé</strong>. Le rang est affiché en <span class="rank-label">gras</span> ! Amuse-toi à régénérer pour t'entraîner plus !</p>
      <div class="grid-2">
        <div><label for="input-e2-unit"><span id="nb-unit"></span> → chiffre des <strong class="rank-label">unités</strong> ?</label><input id="input-e2-unit" data-key="e2-unit" placeholder="Chiffre des unités ?" /></div>
        <div><label for="input-e2-diz"><span id="nb-diz"></span> → chiffre des <strong class="rank-label">dizaines</strong> ?</label><input id="input-e2-diz" data-key="e2-diz" placeholder="Chiffre des dizaines ?" /></div>
        <div><label for="input-e2-cens"><span id="nb-cens"></span> → chiffre des <strong class="rank-label">centaines</strong> ?</label><input id="input-e2-cens" data-key="e2-cens" placeholder="Chiffre des centaines ?" /></div>
        <div><label for="input-e2-mil"><span id="nb-mil"></span> → chiffre des <strong class="rank-label">milliers</strong> ?</label><input id="input-e2-mil" data-key="e2-mil" placeholder="Chiffre des milliers ?" /></div>
        <div><label for="input-e2-dix"><span id="nb-dix"></span> → chiffre des <strong class="rank-label">dixièmes</strong> ?</label><input id="input-e2-dix" data-key="e2-dix" placeholder="Chiffre des dixièmes ?" /></div>
        <div><label for="input-e2-cent"><span id="nb-cent"></span> → chiffre des <strong class="rank-label">centièmes</strong> ?</label><input id="input-e2-cent" data-key="e2-cent" placeholder="Chiffre des centièmes ?" /></div>
        <div><label for="input-e2-mill"><span id="nb-mill"></span> → chiffre des <strong class="rank-label">millièmes</strong> ?</label><input id="input-e2-mill" data-key="e2-mill" placeholder="Chiffre des millièmes ?" /></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn alt" onclick="toggleHelp('h2')">Aide détaillée</button>
        <button class="btn" onclick="corriger2()">Correction</button>
        <button class="btn ghost" onclick="resetExo(2)">Recommencer et régénérer</button>
        <span id="f2" class="feedback"></span>
      </div>
      <div id="h2" class="help">
        <p>Salut ! On va décomposer ça pas à pas.</p>
        <p>La <strong>virgule</strong> sépare la partie entière (gauche) et la partie décimale (droite).</p>
        <p><strong>Partie entière</strong> : compte à l'envers depuis la virgule :</p>
        <ul>
          <li>Juste avant la virgule : <strong class="rank-label">unités</strong></li>
          <li>2e avant : <strong class="rank-label">dizaines</strong></li>
          <li>3e avant : <strong class="rank-label">centaines</strong></li>
          <li>4e avant : <strong class="rank-label">milliers</strong></li>
        </ul>
        <p><strong>Partie décimale</strong> : compte depuis la virgule :</p>
        <ul>
          <li>1er après : <strong class="rank-label">dixièmes</strong></li>
          <li>2e après : <strong class="rank-label">centièmes</strong></li>
          <li>3e après : <strong class="rank-label">millièmes</strong></li>
        </ul>
        <p>Si un rang n'existe pas, c'est 0. Exemple : 5,12 → centaines = 0.</p>
        <p>Compte les chiffres avec ton doigt si besoin. Tu progresses !</p>
      </div>
    </section>

    <!-- EXERCICE 3 -->
    <section id="exo3" class="exo">
      <h2>Exercice 3 — Zéros inutiles</h2>
      <p class="consigne">Réécris chaque nombre en <strong>retirant seulement les zéros inutiles</strong> (pas ceux qui donnent la valeur !). Courage, c'est facile une fois compris !</p>
      <div class="grid-3">
        <div><label for="input-e3-1">009</label><input id="input-e3-1" data-key="e3-1" placeholder="009" /></div>
        <div><label for="input-e3-2">05900</label><input id="input-e3-2" data-key="e3-2" placeholder="05900" /></div>
        <div><label for="input-e3-3">500</label><input id="input-e3-3" data-key="e3-3" placeholder="500" /></div>
        <div><label for="input-e3-4">02,07500</label><input id="input-e3-4" data-key="e3-4" placeholder="02,07500" /></div>
        <div><label for="input-e3-5">08000</label><input id="input-e3-5" data-key="e3-5" placeholder="08000" /></div>
        <div><label for="input-e3-6">0070</label><input id="input-e3-6" data-key="e3-6" placeholder="0070" /></div>
        <div><label for="input-e3-7">023,005600</label><input id="input-e3-7" data-key="e3-7" placeholder="023,005600" /></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn alt" onclick="toggleHelp('h3')">Aide détaillée</button>
        <button class="btn" onclick="corriger3()">Correction</button>
        <button class="btn ghost" onclick="resetExo(3)">Recommencer</button>
        <span id="f3" class="feedback"></span>
      </div>
      <div id="h3" class="help">
        <p>Un <strong>zéro inutile</strong> ne change pas la valeur du nombre.</p>
        <ul>
          <li>Au début : 009 → 9</li>
          <li>À la fin de la décimale : 2,07500 → 2,075</li>
          <li>Mais dans 500, les zéros montrent 500, pas 5 → garde-les !</li>
        </ul>
        <p>Essaie sur un papier d'abord. Recommence si besoin !</p>
      </div>
    </section>

    <!-- EXERCICE 4 -->
    <section id="exo4" class="exo">
      <h2>Exercice 4 — Placer la virgule</h2>
      <p class="consigne">Place la virgule pour que le <strong>chiffre 8</strong> soit le <strong>chiffre des centièmes</strong> (2e après la virgule).</p>
      <div class="grid-3">
        <div><label for="input-e4-1">1458 → ?</label><input id="input-e4-1" data-key="e4-1" placeholder="1458 → ?" /></div>
        <div><label for="input-e4-2">651865 → ?</label><input id="input-e4-2" data-key="e4-2" placeholder="651865 → ?" /></div>
        <div><label for="input-e4-3">5163487 → ?</label><input id="input-e4-3" data-key="e4-3" placeholder="5163487 → ?" /></div>
        <div><label for="input-e4-4">8 → ?</label><input id="input-e4-4" data-key="e4-4" placeholder="8 → ?" /></div>
        <div><label for="input-e4-5">89 → ?</label><input id="input-e4-5" data-key="e4-5" placeholder="89 → ?" /></div>
        <div><label for="input-e4-6">3916825 → ?</label><input id="input-e4-6" data-key="e4-6" placeholder="3916825 → ?" /></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn alt" onclick="toggleHelp('h4')">Aide détaillée</button>
        <button class="btn" onclick="corriger4()">Correction</button>
        <button class="btn ghost" onclick="resetExo(4)">Recommencer</button>
        <span id="f4" class="feedback"></span>
      </div>
      <div id="h4" class="help">
        <p>Le <strong>centième</strong> est le 2e chiffre après la virgule.</p>
        <p>Donc, place la virgule <strong>deux positions avant le 8</strong>.</p>
        <p>Exemple : 1458 → <strong>14,58</strong> (8 est le 2e après la virgule).</p>
      </div>
    </section>

    <!-- EXERCICE 5 -->
    <section id="exo5" class="exo">
      <h2>Exercice 5 — Écriture décimale</h2>
      <p class="consigne">Transforme la fraction en <strong>écriture décimale</strong>.</p>
      <div class="grid-2">
        <div><label for="input-e5-1">73/100 = ?</label><input id="input-e5-1" data-key="e5-1" placeholder="73/100 = ?" /></div>
        <div><label for="input-e5-2">7/10 = ?</label><input id="input-e5-2" data-key="e5-2" placeholder="7/10 = ?" /></div>
        <div><label for="input-e5-3">731/1000 = ?</label><input id="input-e5-3" data-key="e5-3" placeholder="731/1000 = ?" /></div>
        <div><label for="input-e5-4">28/1000 = ?</label><input id="input-e5-4" data-key="e5-4" placeholder="28/1000 = ?" /></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn alt" onclick="toggleHelp('h5')">Aide détaillée</button>
        <button class="btn" onclick="corriger5()">Correction</button>
        <button class="btn ghost" onclick="resetExo(5)">Recommencer</button>
        <span id="f5" class="feedback"></span>
      </div>
      <div id="h5" class="help">
        <p>Super question ! Voici comment transformer une fraction en nombre décimal :</p>
        <div class="step">
          <div class="step-title">Étape 1 : Regarde le dénominateur</div>
          <p>Il te dit <strong>combien de chiffres après la virgule</strong> il faut :</p>
          <ul>
            <li><strong>/10</strong> → 1 chiffre après la virgule (dixièmes)</li>
            <li><strong>/100</strong> → 2 chiffres (centièmes)</li>
            <li><strong>/1000</strong> → 3 chiffres (millièmes)</li>
          </ul>
        </div>
        <div class="step">
          <div class="step-title">Étape 2 : Prends le numérateur</div>
          <p>C’est lui qui va devenir le nombre après la virgule.</p>
        </div>
        <div class="step">
          <div class="step-title">Étape 3 : Ajoute des zéros si besoin</div>
          <p>Exemple : <strong>73/100</strong></p>
          <ul>
            <li>Dénominateur = 100 → <strong>2 chiffres après la virgule</strong></li>
            <li>Numérateur = 73 → on écrit <strong>0,73</strong> (on ajoute un 0 devant)</li>
          </ul>
          <p>Exemple : <strong>7/10</strong></p>
          <ul>
            <li>Dénominateur = 10 → <strong>1 chiffre après la virgule</strong></li>
            <li>Numérateur = 7 → on écrit <strong>0,7</strong></li>
          </ul>
        </div>
        <div class="step">
          <div class="step-title">Étape 4 : Si le numérateur est plus grand que le dénominateur</div>
          <p>Exemple : <strong>28/1000</strong></p>
          <ul>
            <li>28 ÷ 1000 = 0,028 → <strong>0,028</strong></li>
          </ul>
        </div>
        <p><strong>En résumé :</strong> Mets le numérateur après la virgule, et ajoute des zéros devant si besoin pour avoir le bon nombre de chiffres.</p>
        <p>Tu vas y arriver ! Essaie avec un crayon si tu veux. Tu es sur la bonne voie !</p>
      </div>
    </section>

    <!-- EXERCICE 6 -->
    <section id="exo6" class="exo">
      <h2>Exercice 6 — Quel est le rang du 3 ?</h2>
      <p class="consigne">Choisis le <strong>rang</strong> du chiffre 3 : unités / dizaines / centaines / dixièmes / centièmes / millièmes.</p>
      <div class="grid-2">
        <div><label for="select-e6-1">43,546 → rang du 3 ?</label><select id="select-e6-1" data-key="e6-1"><option value="">43,546 → rang du 3 ?</option><option>unités</option><option>dizaines</option><option>centaines</option><option>dixièmes</option><option>centièmes</option><option>millièmes</option></select></div>
        <div><label for="select-e6-2">624,23 → rang du 3 ?</label><select id="select-e6-2" data-key="e6-2"><option value="">624,23 → rang du 3 ?</option><option>unités</option><option>dizaines</option><option>centaines</option><option>dixièmes</option><option>centièmes</option><option>millièmes</option></select></div>
        <div><label for="select-e6-3">250,503 → rang du 3 ?</label><select id="select-e6-3" data-key="e6-3"><option value="">250,503 → rang du 3 ?</option><option>unités</option><option>dizaines</option><option>centaines</option><option>dixièmes</option><option>centièmes</option><option>millièmes</option></select></div>
        <div><label for="select-e6-4">0,310 → rang du 3 ?</label><select id="select-e6-4" data-key="e6-4"><option value="">0,310 → rang du 3 ?</option><option>unités</option><option>dizaines</option><option>centaines</option><option>dixièmes</option><option>centièmes</option><option>millièmes</option></select></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn alt" onclick="toggleHelp('h6')">Aide détaillée</button>
        <button class="btn" onclick="corriger6()">Correction</button>
        <button class="btn ghost" onclick="resetExo(6)">Recommencer</button>
        <span id="f6" class="feedback"></span>
      </div>
      <div id="h6" class="help">
        <p>Dans 43,546 : 4= dizaines, 3= unités. Après la virgule : 5= dixièmes, 4= centièmes, 6= millièmes.</p>
      </div>
    </section>

    <!-- EXERCICE 7 -->
    <section id="exo7" class="exo">
      <h2>Exercice 7 — Écrire sous forme décimale</h2>
      <p class="consigne">Convertis chaque fraction en <strong>nombre décimal</strong>. Tu vas voir, c’est comme transformer une fraction en pièce de puzzle !</p>
      <div class="grid-2">
        <div><label for="input-e7-1">84/100 = ?</label><input id="input-e7-1" data-key="e7-1" placeholder="84/100 = ?" /></div>
        <div><label for="input-e7-2">27/10 = ?</label><input id="input-e7-2" data-key="e7-2" placeholder="27/10 = ?" /></div>
        <div><label for="input-e7-3">71/1000 = ?</label><input id="input-e7-3" data-key="e7-3" placeholder="71/1000 = ?" /></div>
        <div><label for="input-e7-4">157/10 = ?</label><input id="input-e7-4" data-key="e7-4" placeholder="157/10 = ?" /></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn alt" onclick="toggleHelp('h7')">Aide détaillée</button>
        <button class="btn" onclick="corriger7()">Correction</button>
        <button class="btn ghost" onclick="resetExo(7)">Recommencer</button>
        <span id="f7" class="feedback"></span>
      </div>
      <div id="h7" class="help">
        <p>Salut ! On va transformer une fraction en nombre décimal. C’est facile avec cette méthode !</p>
        <div class="step">
          <div class="step-title">Étape 1 : Regarde le dénominateur</div>
          <p>Il te dit <strong>combien de chiffres après la virgule</strong> :</p>
          <ul>
            <li><strong>/10</strong> → 1 chiffre après la virgule (dixièmes)</li>
            <li><strong>/100</strong> → 2 chiffres (centièmes)</li>
            <li><strong>/1000</strong> → 3 chiffres (millièmes)</li>
          </ul>
        </div>
        <div class="step">
          <div class="step-title">Étape 2 : Prends le numérateur</div>
          <p>C’est lui qui va devenir le nombre après la virgule.</p>
        </div>
        <div class="step">
          <div class="step-title">Étape 3 : Ajoute des zéros si besoin</div>
          <p>Exemple : <strong>84/100</strong></p>
          <ul>
            <li>Dénominateur = 100 → <strong>2 chiffres après la virgule</strong></li>
            <li>Numérateur = 84 → on écrit <strong>0,84</strong> (on ajoute un 0 devant)</li>
          </ul>
          <p>Exemple : <strong>27/10</strong></p>
          <ul>
            <li>Dénominateur = 10 → <strong>1 chiffre après la virgule</strong></li>
            <li>Numérateur = 27 → on écrit <strong>2,7</strong> (le 2 avant, le 7 après)</li>
          </ul>
        </div>
        <div class="step">
          <div class="step-title">Étape 4 : Si le numérateur est plus grand que le dénominateur</div>
          <p>Exemple : <strong>157/10</strong></p>
          <ul>
            <li>157 ÷ 10 = 15,7 → <strong>15,7</strong></li>
            <li>Tu peux aussi penser : 157 dixièmes = 15 + 7 dixièmes = <strong>15,7</strong></li>
          </ul>
        </div>
        <p><strong>En résumé :</strong> Mets le numérateur après la virgule, et ajoute des zéros devant si besoin pour avoir le bon nombre de chiffres.</p>
        <p>Tu vas y arriver ! Essaie avec un crayon si tu veux. Tu es sur la bonne voie !</p>
      </div>
    </section>

    <!-- EXERCICE 8 -->
    <section id="exo8" class="exo">
      <h2>Exercice 8 — Une seule fraction décimale</h2>
      <p class="consigne">Écris chaque somme <strong>sous la forme d’une seule fraction décimale</strong> (comme 527/100).</p>
      <div class="grid-2">
        <div><label for="input-e8-1">5 + 2/10 + 7/100 = ?/ ?</label><input id="input-e8-1" data-key="e8-1" placeholder="5 + 2/10 + 7/100 = ?/ ?" /></div>
        <div><label for="input-e8-2">9 + 4/100 + 6/1000 = ?/ ?</label><input id="input-e8-2" data-key="e8-2" placeholder="9 + 4/100 + 6/1000 = ?/ ?" /></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn alt" onclick="toggleHelp('h8')">Aide détaillée</button>
        <button class="btn" onclick="corriger8()">Correction</button>
        <button class="btn ghost" onclick="resetExo(8)">Recommencer</button>
        <span id="f8" class="feedback"></span>
      </div>
      <div id="h8" class="help">
        <p>On va transformer une somme en <strong>une seule fraction</strong>. C’est comme ranger plusieurs pièces dans une seule boîte !</p>
        <div class="step">
          <div class="step-title">Étape 1 : Trouve le plus grand dénominateur</div>
          <p>Regarde tous les dénominateurs : 10, 100, 1000 → le plus grand est <strong>1000</strong>.</p>
        </div>
        <div class="step">
          <div class="step-title">Étape 2 : Transforme tout en millièmes</div>
          <p>Exemple : <strong>5 + 2/10 + 7/100</strong></p>
          <ul>
            <li>5 = <strong>5000/1000</strong> (5 entiers = 5000 millièmes)</li>
            <li>2/10 = <strong>200/1000</strong> (2 dixièmes = 200 millièmes)</li>
            <li>7/100 = <strong>70/1000</strong> (7 centièmes = 70 millièmes)</li>
          </ul>
        </div>
        <div class="step">
          <div class="step-title">Étape 3 : Additionne les numérateurs</div>
          <p>5000 + 200 + 70 = <strong>5270</strong></p>
          <p>Résultat : <strong>5270/1000</strong></p>
        </div>
        <p><strong>En résumé :</strong> Mets tout sur le même dénominateur (le plus grand), puis additionne les numérateurs.</p>
        <p>Tu es un génie des fractions !</p>
      </div>
    </section>

    <!-- EXERCICE 9 -->
    <section id="exo9" class="exo">
      <h2>Exercice 9 — Lequel n’est pas égal ?</h2>
      <p class="consigne">Dans chaque ligne, <strong>coche</strong> le nombre qui n’est <em>pas</em> égal aux deux autres.</p>
      <div>
        <p><strong>1)</strong> 45 dixièmes — 45/10 — 0,45 — 4 + 5/10</p>
        <div class="row">
          <label><input type="radio" name="e9-1" value="A" /> 45/10</label>
          <label><input type="radio" name="e9-1" value="B" /> 0,45</label>
          <label><input type="radio" name="e9-1" value="C" /> 4 + 5/10</label>
        </div>
        <p><strong>2)</strong> 583 centièmes — 5 + 83/10 — 5 + 83/100 — 5,83</p>
        <div class="row">
          <label><input type="radio" name="e9-2" value="A" /> 5 + 83/10</label>
          <label><input type="radio" name="e9-2" value="B" /> 5 + 83/100</label>
          <label><input type="radio" name="e9-2" value="C" /> 5,83</label>
        </div>
        <p><strong>3)</strong> 307 millièmes — 3/10 + 7/1000 — 307/1000 — 3 + 7/1000</p>
        <div class="row">
          <label><input type="radio" name="e9-3" value="A" /> 3/10 + 7/1000</label>
          <label><input type="radio" name="e9-3" value="B" /> 307/1000</label>
          <label><input type="radio" name="e9-3" value="C" /> 3 + 7/1000</label>
        </div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn alt" onclick="toggleHelp('h9')">Aide détaillée</button>
        <button class="btn" onclick="corriger9()">Correction</button>
        <button class="btn ghost" onclick="resetExo(9)">Recommencer</button>
        <span id="f9" class="feedback"></span>
      </div>
      <div id="h9" class="help">
        <p>Trouve le <strong>différent</strong> ! Transforme tout en <strong>décimal</strong> pour comparer.</p>
        <div class="step">
          <div class="step-title">Exemple : ligne 1</div>
          <ul>
            <li>45 dixièmes = <strong>4,5</strong></li>
            <li>45/10 = <strong>4,5</strong></li>
            <li>0,45 = <strong>0,45</strong> → c’est le différent !</li>
            <li>4 + 5/10 = 4 + 0,5 = <strong>4,5</strong></li>
          </ul>
        </div>
        <p><strong>Méthode :</strong> Transforme tout en décimal, puis coche le seul qui ne donne pas le même nombre.</p>
        <p>Tu es un détective des nombres !</p>
      </div>
    </section>

    <!-- EXERCICE 10 -->
    <section id="exo10" class="exo">
      <h2>Exercice 10 — Compléter les fractions</h2>
      <p class="consigne">Écris les <strong>numérateurs manquants</strong>.</p>
      <div class="grid-3">
        <div><label for="input-e10-1">1 = … /10</label><input id="input-e10-1" data-key="e10-1" placeholder="1 = … /10" /></div>
        <div><label for="input-e10-2">8 = … /10</label><input id="input-e10-2" data-key="e10-2" placeholder="8 = … /10" /></div>
        <div><label for="input-e10-3">0,05 = … /100</label><input id="input-e10-3" data-key="e10-3" placeholder="0,05 = … /100" /></div>
        <div><label for="input-e10-4">0,7 = … /10</label><input id="input-e10-4" data-key="e10-4" placeholder="0,7 = … /10" /></div>
        <div><label for="input-e10-5">2 = … /100</label><input id="input-e10-5" data-key="e10-5" placeholder="2 = … /100" /></div>
        <div><label for="input-e10-6">3,54 = … /100</label><input id="input-e10-6" data-key="e10-6" placeholder="3,54 = … /100" /></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn alt" onclick="toggleHelp('h10')">Aide détaillée</button>
        <button class="btn" onclick="corriger10()">Correction</button>
        <button class="btn ghost" onclick="resetExo(10)">Recommencer</button>
        <span id="f10" class="feedback"></span>
      </div>
      <div id="h10" class="help">
        <p>Complète la fraction en trouvant le numérateur manquant !</p>
        <div class="step">
          <div class="step-title">Règle simple :</div>
          <p>Enlève la virgule et mets le nombre comme numérateur, selon le dénominateur :</p>
          <ul>
            <li><strong>/10</strong> → 1 chiffre après la virgule → enlève la virgule → <strong>numérateur = le nombre entier</strong></li>
            <li><strong>/100</strong> → 2 chiffres → <strong>numérateur = le nombre sans virgule</strong></li>
          </ul>
        </div>
        <div class="step">
          <div class="step-title">Exemples :</div>
          <ul>
            <li><strong>1 = ? /10</strong> → 1 = 10/10 → <strong>10</strong></li>
            <li><strong>0,05 = ? /100</strong> → 0,05 = 5/100 → <strong>5</strong></li>
            <li><strong>3,54 = ? /100</strong> → 3,54 = 354/100 → <strong>354</strong></li>
          </ul>
        </div>
        <p>Tu es un as des fractions !</p>
      </div>
    </section>

    <!-- EXERCICE 11 -->
    <section id="exo11" class="exo">
      <h2>Exercice 11 — Ajouter deux dixièmes</h2>
      <p class="consigne">À chaque nombre, ajoute <strong>0,2</strong> (deux dixièmes).</p>
      <div class="grid-2">
        <div><label for="input-e11-1">198,04 + 0,2 = ?</label><input id="input-e11-1" data-key="e11-1" placeholder="198,04 + 0,2 = ?" /></div>
        <div><label for="input-e11-2">134102,84 + 0,2 = ?</label><input id="input-e11-2" data-key="e11-2" placeholder="134102,84 + 0,2 = ?" /></div>
        <div><label for="input-e11-3">321,8 + 0,2 = ?</label><input id="input-e11-3" data-key="e11-3" placeholder="321,8 + 0,2 = ?" /></div>
        <div><label for="input-e11-4">417,437 + 0,2 = ?</label><input id="input-e11-4" data-key="e11-4" placeholder="417,437 + 0,2 = ?" /></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn alt" onclick="toggleHelp('h11')">Aide détaillée</button>
        <button class="btn" onclick="corriger11()">Correction</button>
        <button class="btn ghost" onclick="resetExo(11)">Recommencer</button>
        <span id="f11" class="feedback"></span>
      </div>
      <div id="h11" class="help">
        <p>Ajouter 0,2, c’est comme ajouter 2 dixièmes. On travaille sur le chiffre des dixièmes !</p>
        <div class="step">
          <div class="step-title">Méthode :</div>
          <ul>
            <li>Regarde le <strong>chiffre des dixièmes</strong> (1er après la virgule)</li>
            <li>Ajoute 2</li>
            <li>Si le résultat ≥ 10 → retiens 1 pour les unités</li>
          </ul>
        </div>
        <div class="step">
          <div class="step-title">Exemple : 321,8 + 0,2</div>
          <ul>
            <li>Dixièmes = 8</li>
            <li>8 + 2 = 10 → on écrit 0, et on ajoute 1 aux unités</li>
            <li>321 + 1 = 322 →,0</li>
          </ul>
        </div>
        <p>Tu es un pro de l’addition décimale !</p>
      </div>
    </section>

    <!-- EXERCICE 12 -->
    <section id="exo12" class="exo">
      <h2>Exercice 12 — Nombre mystère à 4 chiffres</h2>
      <p class="consigne">Trouve le nombre entier (4 chiffres). Indices :</p>
      <ul>
        <li>dizaines = unités de millions de 49 605 032,3</li>
        <li>unités = millièmes de 45,128</li>
        <li>centaines = dixièmes de 0,743</li>
        <li>milliers = centièmes de 24 031,5434</li>
      </ul>
      <div>
        <label for="input-e12">Nombre mystère = ?</label>
        <input id="input-e12" data-key="e12" class="short" placeholder="Nombre mystère = ?" />
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn alt" onclick="toggleHelp('h12')">Aide détaillée</button>
        <button class="btn" onclick="corriger12()">Correction</button>
        <button class="btn ghost" onclick="resetExo(12)">Recommencer</button>
        <span id="f12" class="feedback"></span>
      </div>
      <div id="h12" class="help">
        <p>Tu es un détective ! Résous chaque indice un par un.</p>
        <div class="step">
          <div class="step-title">Indice 1 : dizaines = unités de millions de 49 605 032,3</div>
          <p>Unités de millions = dernier chiffre avant la virgule → <strong>2</strong> → dizaines = 2</p>
        </div>
        <div class="step">
          <div class="step-title">Indice 2 : unités = millièmes de 45,128</div>
          <p>Millièmes = 3e chiffre après la virgule → <strong>8</strong> → unités = 8</p>
        </div>
        <div class="step">
          <div class="step-title">Indice 3 : centaines = dixièmes de 0,743</div>
          <p>Dixièmes = 1er après la virgule → <strong>7</strong> → centaines = 7</p>
        </div>
        <div class="step">
          <div class="step-title">Indice 4 : milliers = centièmes de 24 031,5434</div>
          <p>Centièmes = 2e après la virgule → <strong>4</strong> → milliers = 4</p>
        </div>
        <p>Nombre : <strong>4 7 9 8</strong> → <strong>4798</strong></p>
        <p>Tu as résolu le mystère !</p>
      </div>
    </section>

    <!-- EXERCICE 13 -->
    <section id="exo13" class="exo">
      <h2>Exercice 13 — Écrire en toutes lettres</h2>
      <p class="consigne">Écris les nombres en lettres (on te donnera un exemple lors de la correction).</p>
      <div class="grid-3">
        <div><label for="input-e13-1">10,013 → en lettres</label><input id="input-e13-1" data-key="e13-1" placeholder="10,013 → en lettres" /></div>
        <div><label for="input-e13-2">750103,00083 → en lettres</label><input id="input-e13-2" data-key="e13-2" placeholder="750103,00083 → en lettres" /></div>
        <div><label for="input-e13-3">276,053 → en lettres</label><input id="input-e13-3" data-key="e13-3" placeholder="276,053 → en lettres" /></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn alt" onclick="toggleHelp('h13')">Aide détaillée</button>
        <button class="btn" onclick="corriger13()">Correction</button>
        <button class="btn ghost" onclick="resetExo(13)">Recommencer</button>
        <span id="f13" class="feedback"></span>
      </div>
      <div id="h13" class="help">
        <p>On lit le nombre comme on le dit à voix haute !</p>
        <div class="step">
          <div class="step-title">Règle :</div>
          <ul>
            <li>Partie entière → comme un nombre normal</li>
            <li>Virgule → on dit "virgule"</li>
            <li>Partie décimale → on lit les chiffres un par un + le rang</li>
          </ul>
        </div>
        <div class="step">
          <div class="step-title">Exemple : 10,013</div>
          <ul>
            <li>10 → dix</li>
            <li>virgule</li>
            <li>013 → zéro un trois <strong>millièmes</strong></li>
            <li><strong>dix virgule zéro treize millièmes</strong></li>
          </ul>
        </div>
        <p>Tu es un champion de l’écriture !</p>
      </div>
    </section>

    <!-- EXERCICE 14 -->
    <section id="exo14" class="exo">
      <h2>Exercice 14 — Une seule fraction (suite)</h2>
      <p class="consigne">Réécris chaque expression avec <strong>une seule fraction</strong> (numérateur / dénominateur).</p>
      <div class="grid-2">
        <div><label for="input-e14-1">1 + 84/100 = ?/ ?</label><input id="input-e14-1" data-key="e14-1" placeholder="1 + 84/100 = ?/ ?" /></div>
        <div><label for="input-e14-2">14/10 + 7/100 = ?/ ?</label><input id="input-e14-2" data-key="e14-2" placeholder="14/10 + 7/100 = ?/ ?" /></div>
        <div><label for="input-e14-3">3 + 71/1000 = ?/ ?</label><input id="input-e14-3" data-key="e14-3" placeholder="3 + 71/1000 = ?/ ?" /></div>
        <div><label for="input-e14-4">2 + 7/10 + 157/1000 = ?/ ?</label><input id="input-e14-4" data-key="e14-4" placeholder="2 + 7/10 + 157/1000 = ?/ ?" /></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn alt" onclick="toggleHelp('h14')">Aide détaillée</button>
        <button class="btn" onclick="corriger14()">Correction</button>
        <button class="btn ghost" onclick="resetExo(14)">Recommencer</button>
        <span id="f14" class="feedback"></span>
      </div>
      <div id="h14" class="help">
        <p>On remet tout sur le même dénominateur !</p>
        <div class="step">
          <div class="step-title">Exemple : 1 + 84/100</div>
          <ul>
            <li>1 = <strong>100/100</strong></li>
            <li>84/100 reste</li>
            <li>100/100 + 84/100 = <strong>184/100</strong></li>
          </ul>
        </div>
        <p><strong>Méthode :</strong> Transforme les entiers en fractions avec le même dénominateur, puis additionne.</p>
        <p>Tu es un maître des fractions !</p>
      </div>
    </section>

  </main>

  <script>
    // === UTILITAIRES ===
    const $ = (sel, root = document) => root.querySelector(sel);
    const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
    const nrm = s => (s == null ? "" : String(s).trim().replace(/\s+/g, "").replace(/,/g, ".").toLowerCase());
    const eqAny = (val, arr) => arr.map(nrm).includes(nrm(val));
    const toggleHelp = id => { 
      const el = $("#" + id); 
      if (!el) return;
      el.style.display = (el.style.display === "block") ? "none" : "block"; 
    };
    const get = key => nrm($(`[data-key="${key}"]`)?.value || "");
    const getRadio = name => nrm(document.querySelector(`input[name="${name}"]:checked`)?.value || "");
    const resetExo = (n) => {
      $$(`[data-key^="e${n}"]`).forEach(el => el.value = '');
      if (n === 9) $$(`input[name^="e9-"]`).forEach(el => el.checked = false);
      const f = $(`#f${n}`);
      if (f) {
        f.textContent = '';
        f.className = 'feedback';
      }
      if (n === 2) generateExo2();   // Régénère les nombres de l'exercice 2
    };

    // === CONFETTIS (sécurisé si canvas absent) ===
    const canvas = $('#confetti-canvas');
    let ctx = null;
    if (canvas) {
      ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      });
    }
    let confetti = [];
    const launchConfetti = () => {
      if (!ctx || !canvas) return;
      confetti = [];
      for (let i = 0; i < 300; i++) {
        confetti.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height - canvas.height,
          r: Math.random() * 4 + 1,
          d: Math.random() * 300,
          color: `hsl(${Math.random() * 360}, 100%, 50%)`,
          tilt: Math.random() * 10 - 10,
          tiltAngleIncrement: Math.random() * 0.07 + 0.05,
          tiltAngle: 0
        });
      }
      const animate = () => {
        if (!ctx || !canvas) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        confetti.forEach(p => {
          p.tiltAngle += p.tiltAngleIncrement;
          p.y += (Math.cos(p.d) + 3 + p.r / 2) / 2;
          p.tilt = Math.sin(p.tiltAngle) * 15;
          if (p.y <= canvas.height) {
            ctx.beginPath();
            ctx.lineWidth = p.r;
            ctx.strokeStyle = p.color;
            ctx.moveTo(p.x + p.tilt + p.r / 4, p.y);
            ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r / 4);
            ctx.stroke();
          }
        });
        confetti = confetti.filter(p => p.y <= canvas.height);
        if (confetti.length > 0) requestAnimationFrame(animate);
      };
      animate();
    };

    // === CHRONOMÈTRE ===
    let timerInterval, startTime;
    const updateTimer = () => {
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const mins = String(Math.floor(elapsed / 60)).padStart(2, '0');
      const secs = String(elapsed % 60).padStart(2, '0');
      $('#timer').textContent = `Temps : ${mins}:${secs}`;
    };
    $('#timer-mode').addEventListener('change', () => {
      if ($('#timer-mode').checked) {
        startTime = Date.now();
        timerInterval = setInterval(updateTimer, 1000);
        updateTimer();
      } else {
        clearInterval(timerInterval);
        $('#timer').textContent = 'Mode chronométré désactivé';
      }
    });
    if ($('#timer-mode').checked) {
      startTime = Date.now();
      timerInterval = setInterval(updateTimer, 1000);
    }

    // === SAUVEGARDE ===
    let totalScore = 0, maxScore = 0;
    let earnedBadges = new Set();
    const saveProgress = () => {
      const data = { totalScore, maxScore, earnedBadges: Array.from(earnedBadges) };
      localStorage.setItem('decimalProgress', JSON.stringify(data));
    };
    const loadProgress = () => {
      const data = JSON.parse(localStorage.getItem('decimalProgress') || '{}');
      totalScore = data.totalScore || 0;
      maxScore = data.maxScore || 0;
      earnedBadges = new Set(data.earnedBadges || []);
      updateGlobalScore();
      updateBadges(Math.round((totalScore / maxScore) * 100) || 0);
    };
    window.addEventListener('beforeunload', saveProgress);
    window.addEventListener('load', loadProgress);

    // === MODE FACILE & EXO 2 — NOMBRES AFFICHÉS CORRECTEMENT ===
    const easyMode = $('#easy-mode');
    if (easyMode) {
      easyMode.addEventListener('change', () => {
        generateExo2();   // Régénération quand le mode facile change
      });
    }
    let expected2 = {};
    const generateExo2 = () => {
      const isEasy = easyMode?.checked || false;
      const rangs = [
        {name: 'unit', minInt: isEasy ? 0 : 0,    maxInt: isEasy ? 99 : 9999,   decDigits: isEasy ? 1 : 3, isDecimal: false},
        {name: 'diz',  minInt: isEasy ? 10 : 10,  maxInt: isEasy ? 99 : 9999,   decDigits: isEasy ? 1 : 3, isDecimal: false},
        {name: 'cens', minInt: isEasy ? 0 : 100,  maxInt: isEasy ? 999 : 9999,  decDigits: isEasy ? 1 : 3, isDecimal: false},
        {name: 'mil',  minInt: isEasy ? 0 : 1000, maxInt: isEasy ? 9999 : 99999,decDigits: isEasy ? 1 : 3, isDecimal: false},
        {name: 'dix',  minInt: 0,                 maxInt: isEasy ? 9 : 999,     decDigits: 1,             isDecimal: true},
        {name: 'cent', minInt: 0,                 maxInt: isEasy ? 99 : 999,    decDigits: 2,             isDecimal: true},
        {name: 'mill', minInt: 0,                 maxInt: 999,                  decDigits: 3,             isDecimal: true},
      ];
      rangs.forEach(r => {
        let intPart = Math.floor(Math.random() * (r.maxInt - r.minInt + 1)) + r.minInt;
        let decPart = '';
        for (let i = 0; i < r.decDigits; i++) decPart += Math.floor(Math.random() * 10);
        let nbStr = String(intPart);
        if (r.isDecimal || Math.random() < 0.7) nbStr += ',' + decPart;
        const span = $(`#nb-${r.name}`);
        if (span) span.textContent = nbStr; // Affichage du nombre généré
        const [intStr, decStr = ''] = nbStr.split(',');
        const intNum = parseInt(intStr, 10) || 0;
        let chiffre;
        if (r.name === 'unit') chiffre = intNum % 10;
        else if (r.name === 'diz')  chiffre = Math.floor((intNum % 100) / 10);
        else if (r.name === 'cens') chiffre = Math.floor((intNum % 1000) / 100);
        else if (r.name === 'mil')  chiffre = Math.floor((intNum % 10000) / 1000);
        else if (r.name === 'dix')  chiffre = decStr[0] || 0;
        else if (r.name === 'cent') chiffre = decStr[1] || 0;
        else if (r.name === 'mill') chiffre = decStr[2] || 0;
        expected2[`e2-${r.name}`] = String(chiffre);
      });
    };

    // === SCORE & BADGES ===
    const updateGlobalScore = () => {
      const percent = maxScore ? Math.round((totalScore / maxScore) * 100) : 0;
      $('#global-score').textContent = `Score total : ${totalScore} / ${maxScore} (${percent}%)`;
      updateBadges(percent);
    };
    const badges = [
      { min: 0,   name: "Débutant en décimales" },
      { min: 30,  name: "Apprenti des virgules" },
      { min: 60,  name: "Champion des fractions" },
      { min: 80,  name: "Maître des décimaux" },
      { min: 95,  name: "Légende des nombres" }
    ];
    const updateBadges = (percent) => {
      badges.forEach(b => {
        if (percent >= b.min && !earnedBadges.has(b.name)) {
          earnedBadges.add(b.name);
          const span = document.createElement('span');
          span.className = 'badge-earned';
          span.textContent = ` ${b.name} `;
          $('#badges').appendChild(span);
          playSound(true);
        }
      });
    };
    const addScore = (points, max) => {
      totalScore += points; 
      maxScore += max;
      updateGlobalScore();
      if (getPercent() === 100) {
        launchConfetti();
        playSound(true);
      }
    };
    const getPercent = () => maxScore ? Math.round((totalScore / maxScore) * 100) : 0;

    // === SONS ===
    const playSound = (success) => {
      const audio = success ? $('#sound-success') : $('#sound-error');
      if (!audio) return;
      audio.currentTime = 0;
      audio.play().catch(() => {});
    };

    // === CORRECTIONS ===
    const corriger1 = () => {
      let feedback = "Voici ton feedback détaillé :\n", count = 0;
      const check = (key, correct, label) => {
        const input = $(`[data-key="${key}"]`);
        if (eqAny(get(key), correct)) {
          feedback += `${label} : Correct !\n`;
          count++;
          if (input) input.style.borderColor = 'var(--good)';
        } else {
          feedback += `${label} : Presque ! C'est ${correct[0]}.\n`;
          if (input) input.style.borderColor = 'var(--bad)';
        }
      };
      check('e1a-ent', ['4'], '1a entière');
      check('e1a-dec', ['53/100','0.53','53'], '1a décimale');
      check('e1b-ent', ['529'], '1b entière');
      check('e1b-dec', ['5/10','0.5','5'], '1b décimale');
      check('e1c-ent', ['0'], '1c entière');
      check('e1c-dec', ['83/100','0.83','83'], '1c décimale');
      const enc = count === 6 ? "Parfait !" : "Tu y es presque !";
      feedback += `\nScore : ${count}/6. ${enc}`;
      $('#f1').textContent = feedback;
      $('#f1').className = 'feedback ' + (count === 6 ? 'ok' : 'no');
      playSound(count === 6);
      addScore(count, 6);
    };

    const corriger2 = () => {
      let feedback = "Feedback détaillé :\n", count = 0;
      ['unit', 'diz', 'cens', 'mil', 'dix', 'cent', 'mill'].forEach(name => {
        const key = `e2-${name}`;
        const labelEl = $(`label[for="input-${key}"] .rank-label`);
        const label = labelEl ? labelEl.textContent : key;
        if (eqAny(get(key), [expected2[key]])) {
          feedback += `${label} : Correct !\n`;
          count++;
        } else {
          feedback += `${label} : Faux, c'est ${expected2[key]}.\n`;
        }
      });
      const enc = count === 7 ? "Parfait ! Tu es un pro des rangs !" : "Presque ! Recommence pour tout maîtriser !";
      feedback += `\nScore : ${count}/7. ${enc}`;
      $('#f2').textContent = feedback;
      $('#f2').className = 'feedback ' + (count === 7 ? 'ok' : 'no');
      playSound(count === 7);
      addScore(count, 7);
    };

    const corriger3 = () => {
      let feedback = "Feedback détaillé :\n", count = 0;
      const check = (key, correct, label) => {
        if (eqAny(get(key), correct)) {
          feedback += `${label} : Correct !\n`;
          count++;
        } else {
          feedback += `${label} : Faux, c'est ${correct[0]}.\n`;
        }
      };
      check('e3-1', ['9'], '1');
      check('e3-2', ['5900'], '2');
      check('e3-3', ['500'], '3');
      check('e3-4', ['2.075','2,075'], '4');
      check('e3-5', ['8000'], '5');
      check('e3-6', ['70'], '6');
      check('e3-7', ['23.0056','23,0056'], '7');
      feedback += `\nScore : ${count}/7. Bravo !`;
      $('#f3').textContent = feedback;
      $('#f3').className = 'feedback ' + (count === 7 ? 'ok' : 'no');
      playSound(count === 7);
      addScore(count, 7);
    };

    const corriger4 = () => {
      let feedback = "Feedback détaillé :\n", count = 0;
      const check = (key, correct, label) => {
        if (eqAny(get(key), correct)) {
          feedback += `${label} : Correct !\n`;
          count++;
        } else {
          feedback += `${label} : Faux, c'est ${correct[0]}.\n`;
        }
      };
      check('e4-1', ['14.58','14,58'], '1');
      check('e4-2', ['65.1865','65,1865'], '2');
      check('e4-3', ['5163.487','5163,487'], '3');
      check('e4-4', ['0.08','0,08'], '4');
      check('e4-5', ['0.089','0,089'], '5');
      check('e4-6', ['391.6825','391,6825'], '6');
      feedback += `\nScore : ${count}/6. Super !`;
      $('#f4').textContent = feedback;
      $('#f4').className = 'feedback ' + (count === 6 ? 'ok' : 'no');
      playSound(count === 6);
      addScore(count, 6);
    };

    const corriger5 = () => {
      let feedback = "Feedback détaillé :\n", count = 0;
      const check = (key, correct, label) => {
        if (eqAny(get(key), correct)) {
          feedback += `${label} : Parfait !\n`;
          count++;
        } else {
          feedback += `${label} : Presque ! Rappelle-toi : /100 = 2 chiffres après la virgule.\n`;
        }
      };
      check('e5-1', ['0.73','0,73'], '73/100');
      check('e5-2', ['0.7','0,7'], '7/10');
      check('e5-3', ['0.731','0,731'], '731/1000');
      check('e5-4', ['0.028','0,028'], '28/1000');
      const enc = count === 4 ? "Tu es un expert des décimales !" : "Tu y es presque ! Recommence pour tout maîtriser !";
      feedback += `\nScore : ${count}/4. ${enc}`;
      $('#f5').textContent = feedback;
      $('#f5').className = 'feedback ' + (count === 4 ? 'ok' : 'no');
      playSound(count === 4);
      addScore(count, 4);
    };

    const corriger6 = () => {
      let feedback = "Feedback détaillé :\n", count = 0;
      const check = (key, correct, label) => {
        if (eqAny(get(key), correct)) {
          feedback += `${label} : Correct !\n`;
          count++;
        } else {
          feedback += `${label} : Faux, c'est ${correct[0]}.\n`;
        }
      };
      check('e6-1', ['unités'], '1');
      check('e6-2', ['centièmes'], '2');
      check('e6-3', ['millièmes'], '3');
      check('e6-4', ['dixièmes'], '4');
      feedback += `\nScore : ${count}/4. Bravo !`;
      $('#f6').textContent = feedback;
      $('#f6').className = 'feedback ' + (count === 4 ? 'ok' : 'no');
      playSound(count === 4);
      addScore(count, 4);
    };

    const corriger7 = () => {
      let feedback = "Feedback détaillé :\n", count = 0;
      const check = (key, correct, label) => {
        if (eqAny(get(key), correct)) {
          feedback += `${label} : Correct !\n`;
          count++;
        } else {
          feedback += `${label} : Faux, c'est ${correct[0]}.\n`;
        }
      };
      check('e7-1', ['0.84','0,84'], '84/100');
      check('e7-2', ['2.7','2,7'], '27/10');
      check('e7-3', ['0.071','0,071'], '71/1000');
      check('e7-4', ['15.7','15,7'], '157/10');
      feedback += `\nScore : ${count}/4. Super !`;
      $('#f7').textContent = feedback;
      $('#f7').className = 'feedback ' + (count === 4 ? 'ok' : 'no');
      playSound(count === 4);
      addScore(count, 4);
    };

    const corriger8 = () => {
      let feedback = "Feedback détaillé :\n", count = 0;
      const check = (key, correct, label) => {
        if (eqAny(get(key), correct)) {
          feedback += `${label} : Correct !\n`;
          count++;
        } else {
          feedback += `${label} : Faux, c'est ${correct[0]}.\n`;
        }
      };
      check('e8-1', ['527/100'], '1');
      check('e8-2', ['9046/1000'], '2');
      feedback += `\nScore : ${count}/2. Génial !`;
      $('#f8').textContent = feedback;
      $('#f8').className = 'feedback ' + (count === 2 ? 'ok' : 'no');
      playSound(count === 2);
      addScore(count, 2);
    };

    const corriger9 = () => {
      let feedback = "Feedback détaillé :\n", count = 0;
      const check = (name, correct, label) => {
        if (eqAny(getRadio(name), correct)) {
          feedback += `${label} : Correct !\n`;
          count++;
        } else {
          feedback += `${label} : Faux, c'est ${correct[0]}.\n`;
        }
      };
      check('e9-1', ['B'], '1');
      check('e9-2', ['A'], '2');
      check('e9-3', ['C'], '3');
      feedback += `\nScore : ${count}/3. Bravo !`;
      $('#f9').textContent = feedback;
      $('#f9').className = 'feedback ' + (count === 3 ? 'ok' : 'no');
      playSound(count === 3);
      addScore(count, 3);
    };

    const corriger10 = () => {
      let feedback = "Feedback détaillé :\n", count = 0;
      const check = (key, correct, label) => {
        if (eqAny(get(key), correct)) {
          feedback += `${label} : Correct !\n`;
          count++;
        } else {
          feedback += `${label} : Faux, c'est ${correct[0]}.\n`;
        }
      };
      check('e10-1', ['10'], '1');
      check('e10-2', ['80'], '2');
      check('e10-3', ['5'], '3');
      check('e10-4', ['7'], '4');
      check('e10-5', ['200'], '5');
      check('e10-6', ['354'], '6');
      feedback += `\nScore : ${count}/6. Super !`;
      $('#f10').textContent = feedback;
      $('#f10').className = 'feedback ' + (count === 6 ? 'ok' : 'no');
      playSound(count === 6);
      addScore(count, 6);
    };

    const corriger11 = () => {
      let feedback = "Feedback détaillé :\n", count = 0;
      const check = (key, correct, label) => {
        if (eqAny(get(key), correct)) {
          feedback += `${label} : Correct !\n`;
          count++;
        } else {
          feedback += `${label} : Faux, c'est ${correct[0]}.\n`;
        }
      };
      check('e11-1', ['198.24','198,24'], '1');
      check('e11-2', ['134103.04','134103,04'], '2');
      check('e11-3', ['322','322.0','322,0'], '3');
      check('e11-4', ['417.637','417,637'], '4');
      feedback += `\nScore : ${count}/4. Bravo !`;
      $('#f11').textContent = feedback;
      $('#f11').className = 'feedback ' + (count === 4 ? 'ok' : 'no');
      playSound(count === 4);
      addScore(count, 4);
    };

    const corriger12 = () => {
      let feedback = "Feedback détaillé :\n", count = 0;
      if (eqAny(get('e12'), ['4798'])) {
        feedback += "Correct !\n";
        count++;
      } else {
        feedback += "Faux, c'est 4798.\n";
      }
      feedback += `\nScore : ${count}/1. Génial !`;
      $('#f12').textContent = feedback;
      $('#f12').className = 'feedback ' + (count === 1 ? 'ok' : 'no');
      playSound(count === 1);
      addScore(count, 1);
    };

    const corriger13 = () => {
      let feedback = "Feedback détaillé :\n", count = 0;
      const check = (key, correct, label) => {
        if (eqAny(get(key), correct)) {
          feedback += `${label} : Correct !\n`;
          count++;
        } else {
          feedback += `${label} : Faux, exemple : ${correct[0]}.\n`;
        }
      };
      check('e13-1', ['dixvirgulezero13milliemes', 'dixvirguletreizemilliemes', 'dixvirgule013'], '1');
      check('e13-2', ['septcentcinquantemillecenttroisvirgulezerozerozerohuittroismilliemes', '750103virgule00083'], '2');
      check('e13-3', ['deuxcentsoixante-seizevirgulezerocinquante-troismilliemes', 'deuxcentsoixante-seizevirgulecinquante-troismilliemes', '276virgule053'], '3');
      feedback += `\nScore : ${count}/3. Super !`;
      $('#f13').textContent = feedback;
      $('#f13').className = 'feedback ' + (count === 3 ? 'ok' : 'no');
      playSound(count === 3);
      addScore(count, 3);
    };

    const corriger14 = () => {
      let feedback = "Feedback détaillé :\n", count = 0;
      const check = (key, correct, label) => {
        if (eqAny(get(key), correct)) {
          feedback += `${label} : Correct !\n`;
          count++;
        } else {
          feedback += `${label} : Faux, c'est ${correct[0]}.\n`;
        }
      };
      check('e14-1', ['184/100'], '1');
      check('e14-2', ['147/100'], '2');
      check('e14-3', ['3071/1000'], '3');
      check('e14-4', ['2857/1000'], '4');
      feedback += `\nScore : ${count}/4. Bravo !`;
      $('#f14').textContent = feedback;
      $('#f14').className = 'feedback ' + (count === 4 ? 'ok' : 'no');
      playSound(count === 4);
      addScore(count, 4);
    };

    const corrigerTout = () => {
      totalScore = 0; 
      maxScore = 0;
      [1,2,3,4,5,6,7,8,9,10,11,12,13,14].forEach(n => window[`corriger${n}`]());
    };

    // ✅ Appel direct : les nombres de l'exercice 2 sont générés dès l'ouverture
    generateExo2();
  </script>
</body>
</html>
